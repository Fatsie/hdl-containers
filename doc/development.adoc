== Development

=== Continuous Integration (CI)

[cols="5*.^", frame=none, grid=none]
|===
a|* {blank}
+
--
GHAStatus:doc[]
--

* {blank}
+
--
GHAStatus:base[]
--


a|* {blank}
+
--
GHAStatus:ghdl[]
--
* {blank}
+
--
GHAStatus:gtkwave[]
--
* {blank}
+
--
GHAStatus:verilator[]
--


a|* {blank}
+
--
GHAStatus:ghdl-yosys-plugin[]
--
* {blank}
+
--
GHAStatus:icestorm[]
--
* {blank}
+
--
GHAStatus:prjtrellis[]
--
* {blank}
+
--
GHAStatus:yosys[]
--
* {blank}
+
--
GHAStatus:nextpnr[]
--
* {blank}
+
--
GHAStatus:arachne-pnr[]
--


a|* {blank}
+
--
GHAStatus:boolector[]
--
* {blank}
+
--
GHAStatus:cvc4[]
--
* {blank}
+
--
GHAStatus:superprove[]
--
* {blank}
+
--
GHAStatus:symbiyosys[]
--
* {blank}
+
--
GHAStatus:yices2[]
--
* {blank}
+
--
GHAStatus:z3[]
--


a|* {blank}
+
--
GHAStatus:klayout[]
--


a|* {blank}
+
--
GHAStatus:formal[]
--
* {blank}
+
--
GHAStatus:impl[]
--
* {blank}
+
--
GHAStatus:prog[]
--
|===

NOTE: At the moment, there is no triggering mechanism set up between different GitHub repositories. All the workflows in this repo are triggered by push events, CRON jobs, or manually.

=== Graph generation/parsing

Currently, the <<Graphs>> are updated manually. That is error prone, because the information shown in them is also defined in the dockerfiles and CI workflows. Ideally, graphs would be auto-generated by parsing/analysing those. However, the complexity of the graphs is non trivial. There are many tools for automatically generating diagrams from large datasets, but not so many with features for visualizing complex hierarchical nets. The requirements we are willing to satisfy are the following:

- Open source tool and format(s).
- Generates diagrams programmatically from a text representation and/or through a Python or Golang API.
- Supports hierarchical DAGs with multiple levels of hierarchy. I.e. (nested) clusters which are nodes and have ports.
- Generates SVG of the hierarchical DAGs.
- Supports node styles (shape and colour).
- Ideally:
  - Clusters are collapsible when shown in an HTML site.
  - Text in the nodes can be links to web sites.

So far, the following options were analysed:

* https://graphviz.org/[Graphviz]
** https://github.com/windler/dotgraph[windler/dotgraph]
** http://blockdiag.com/en/blockdiag/examples.html[blockdiag]
* https://gephi.org/[Gephi]
** https://github.com/gephi/gephi/issues/1594[gephi/gephi#1594]
* https://aafigure.readthedocs.io/en/latest/shortintro.html[aafigure]
* https://draw.io[draw.io]
** https://github.com/jgraph/mxgraph[jgraph/mxgraph]
* https://www.yworks.com/products/yed[yEd]
* https://texample.net/tikz/[texample.net/tikz]
* https://github.com/ajstarks/svgo[ajstarks/svgo]
* https://github.com/kieler/elkjs[kieler/elkjs] (https://github.com/Nic30/d3-hwschematic[Nic30/d3-hwschematic], https://github.com/nturley/netlistsvg[nturley/netlistsvg])
* https://github.com/dagrejs/dagre-d3/wiki[dagrejs/dagre-d3]
* https://graphdracula.net[graphdracula.net]

Graphviz and Gephi are probably the most known tools for generating all kinds of diagrams. Unfortunately, none of them supports hierarchical clusters as required in this use case. The same issue applies to aafigure and graphdracula.

yEd is a very interesting product, and fits most (if not all) the technical constraints. However, it's not open source. The editor is freeware and the SDK is paid. For programmatic generation, the SDK is required. The draw.io/mxgraph toolkit seems to be the most similar open source solution. However, using SDKs for building custom interactive diagraming tools feels overkill in this use case. We don't need graphs to be editable through a GUI!

Similarly, Tikz and SVG generation libraries (such as svgo) can be used for having the work done, but they require writing a non-negligible plumbing which would increase the maintenance burden, instead of reducing it. This would be a last resort.

Although d3-hwschematic and netlistsvg are very different use cases, the JSON format used in elkjs might be suitable.

dagre-d3 is meant for DAGs and it supports nested clusters (experimentally, https://dagrejs.github.io/project/dagre-d3/latest/demo/clusters.html[Dagre D3 Demo: Clusters]). Although clusters seem not to have ports, it might be an easy update from the current solution. Since it's a client-side JS library, it does not write an SVG file to disk by default, but achieving it should be trivial.

As a result, it seems that the most suitable solution might be using the JSON format from elkjs, either with elkjs or with dagre-d3. Do you want to give it a try? https://github.com/hdl/containers/issues/new[Let us know] or https://gitter.im/hdl/community[join the chat]!

==== Reading dockerfiles

One of the two sources of information for the graph are dockerfiles. As far as we are aware, there is no tool for generating a DAG from the stages of a dockerfile. However, https://github.com/asottile/dockerfile[asottile/dockerfile] is an interesting Python module which wraps docker/moby's golang parser. Hence, it can be used for getting the stages and ``COPY --from`` or ``--mount`` statements for generating the hierarchy. See link:{repotree}.todo/cli/dfile.py[`.todo/cli/dfile.py`].

==== Reading GitHub Actions workflow files

The second source of information are CI workflow files. Since YAML is used, reading it from any language is trivial, however, semantic analysis needs to be done. Particularly, variables from ``matrix`` need to be expanded/replaced. https://github.com/nektos/act[nektos/act] is written in golang, and it allows executing GitHub Actions workflows locally. Therefore, it might have the required features. However, as far as we are aware, it's not meant to be used as a library.
